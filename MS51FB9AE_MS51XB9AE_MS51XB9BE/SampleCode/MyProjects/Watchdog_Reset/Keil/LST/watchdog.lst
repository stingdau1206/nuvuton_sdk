C51 COMPILER V9.60.0.0   WATCHDOG                                                          08/23/2022 01:58:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE WATCHDOG
OBJECT MODULE PLACED IN .\Output\watchdog.obj
COMPILER INVOKED BY: C:\Keil_v5_8051\C51\BIN\C51.EXE ..\..\..\..\Library\StdDriver\src\watchdog.c OPTIMIZE(7,SPEED) BROW
                    -SE INCDIR(..\..\..\..\Library\Device\Include;..\..\..\..\Library\StdDriver\inc) DEBUG OBJECTEXTEND PRINT(.\LST\watchdog.
                    -lst) TABS(2) OBJECT(.\Output\watchdog.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2020 nuvoton Technology Corp. All rights reserved.                                        
             - */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          //********************************************************************************************************
             -***
   8          //  Website: http://www.nuvoton.com
   9          //  E-Mail : MicroC-8bit@nuvoton.com
  10          //********************************************************************************************************
             -***
  11          #include "MS51_16K.H"
  12          
  13          void Enable_WDT_Reset_Config(void)
  14          {
  15   1          set_CHPCON_IAPEN;
  16   1          IAPAL = 0x04;
  17   1          IAPAH = 0x00;
  18   1          IAPFD = 0x0F;
  19   1          IAPCN = BYTE_PROGRAM_CONFIG;
  20   1          set_IAPUEN_CFUEN;
  21   1          set_IAPTRG_IAPGO;                                  //trigger IAP
  22   1          while((CHPCON&SET_BIT6)==SET_BIT6);          //check IAPFF (CHPCON.6)
  23   1          clr_IAPUEN_CFUEN;
  24   1          clr_CHPCON_IAPEN;
  25   1          set_CHPCON_SWRST;
  26   1      }
  27          
  28          /****************************************************************************/
  29          /* WDT CONFIG disable                                                       */
  30          /* warning : this macro is for CONFIG already enable WDT Reset to disable.  */
  31          /* Since erase CONFIG is full page                                          */
  32          /* step 1. storage CONFIG value in RAM                                      */
  33          /* step 2. modify RAM CONFIG4 WDT value to disable                          */
  34          /* step 3. erase CONFIG page                                                */
  35          /* step 4. re writer CONFIG.                                                */
  36          /* **************************************************************************/
  37          void Disable_WDT_Reset_Config(void)
  38          {
  39   1        UINT8 cf0,cf1,cf2,cf3,cf4;
  40   1        
  41   1          set_CHPCON_IAPEN;
  42   1          IAPAL = 0x00;
  43   1          IAPAH = 0x00;
  44   1          IAPCN = BYTE_READ_CONFIG;
  45   1          set_IAPTRG_IAPGO;                                  //Storage CONFIG0 data
  46   1          cf0 = IAPFD;
C51 COMPILER V9.60.0.0   WATCHDOG                                                          08/23/2022 01:58:57 PAGE 2   

  47   1          IAPAL = 0x01;
  48   1          set_IAPTRG_IAPGO;                                  //Storage CONFIG1 data
  49   1          cf1 = IAPFD;
  50   1          IAPAL = 0x02;
  51   1          set_IAPTRG_IAPGO;                                  //Storage CONFIG2 data
  52   1          cf2 = IAPFD;
  53   1          IAPAL = 0x03;
  54   1          set_IAPTRG_IAPGO;                                  //Storage CONFIG3 data
  55   1          cf3 = IAPFD;
  56   1          IAPAL = 0x04;
  57   1          set_IAPTRG_IAPGO;                                  //Storage CONFIG4 data
  58   1          cf4 = IAPFD;
  59   1          cf4 |= 0xF0;                                      //Moidfy Storage CONFIG4 data disable WDT reset
  60   1          
  61   1          set_IAPUEN_CFUEN;  
  62   1          IAPCN = PAGE_ERASE_CONFIG;                        //Erase CONFIG all
  63   1          IAPAH = 0x00;
  64   1          IAPAL = 0x00;
  65   1          IAPFD = 0xFF;
  66   1          set_IAPTRG_IAPGO;
  67   1          
  68   1          IAPCN = BYTE_PROGRAM_CONFIG;                    //Write CONFIG
  69   1          IAPFD = cf0;
  70   1          set_IAPTRG_IAPGO;
  71   1          IAPAL = 0x01;
  72   1          IAPFD = cf1;
  73   1          set_IAPTRG_IAPGO;
  74   1          IAPAL = 0x02;
  75   1          IAPFD = cf2;
  76   1          set_IAPTRG_IAPGO;
  77   1          IAPAL = 0x03;
  78   1          IAPFD = cf3;
  79   1          set_IAPTRG_IAPGO;
  80   1          IAPAL = 0x04;
  81   1          IAPFD = cf4;
  82   1          set_IAPTRG_IAPGO;
  83   1      
  84   1          set_IAPUEN_CFUEN;
  85   1          clr_CHPCON_IAPEN;
  86   1          if (WDCON&SET_BIT3)
  87   1          {
  88   2            clr_WDCON_WDTRF;
  89   2            set_CHPCON_SWRST;
  90   2          }
  91   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    532    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
